---
title: "iNZight, Surveys, and the IDI"
author: Tom Elliott
date: "Te Rourou Tātaritanga<br>Victoria University of Wellington<br><br>tomelliott.co.nz"
output:
    revealjs::revealjs_presentation:
        theme: simple
        center: true
        slide_level: 1
        mathjax: default
        reveal_options:
            controls: false
            hash: true
        transition: none
        css: assets/style/theme.css
---


# Updates

```{r,echo=FALSE}
ricon <- "<i class=\"fab fa-r-project\"></i>"
ricon <- "<img src=\"assets/images/Rlogo.svg\" class=\"logo\" >"
```

#

## PhD thesis

* submitted 9th April
* defended 25th August
* graduation tomorrow!

#

## PhD thesis (TL;DR)

<ul class="loose">
<li>predicting buses is hard.</li>

<li><strong>real-time traffic data from other buses</strong> to predict upcoming ones ... </li>
<ul class="fa-ul">
    <li class="fragment">
        <span class="fa-li"><i class="far fa-thumbs-down"></i></span>
        point estimates
    </li>
    <li class="fragment">
        <span class="fa-li"><i class="far fa-thumbs-up"></i></span>
        interval estimates
    </li>
</ul>

<li class="fragment">$\mathbb{P}$(catch bus | I arrive by), $\mathbb{P}$(bus arrives before 9am)</li>
<li class="fragment">useful for <strong>probabilistic journey planning</strong></li>
</ul>

<p class="fragment">If you're interested ... [tomelliott.co.nz/phd](https://tomelliott.co.nz/phd)</p>

#

## Postdoc @ VUW @ UoA

* MBIE Endeavour grant

    * Colin Simpson (VUW), Barry Milne (COMPASS), Andrew Sporle

    * Informatics for Social Services and Wellbeing ...

    * more later!

* Honorary position here (thanks James)

# ![iNZight](assets/images/inzight_logo.png)



#

```{r,eval=FALSE}
library(iNZight)
iNZight()
```

<img src="assets/images/inzight_main_window.png"
    alt="iNZight main window"
    width="80%"
    >

# ![iNZight](assets/images/inzight_logo.png)


* my side-project since 2013/14

* shifting focus as audience has evolved

# ![iNZight](assets/images/inzight_logo.png)

### Before 2015

<ul class="fa-ul loose">
<li><span class="fa-li"><i class="fas fa-school"></i></span> schools</li>
<li><span class="fa-li"><i class="fas fa-university"></i></span> some university</li>
</ul>

# ![iNZight](assets/images/inzight_logo.png)
### 2015--2019

<ul class="fa-ul loose">
<li><span class="fa-li"><i class="fas fa-graduation-cap"></i></span> education (school/university/MOOC)</li>
<li><span class="fa-li"><i class="fas fa-globe"></i></span> unexpected places
<ul class="fa-ul loose">
    <li class="fragment"><span class="fa-li"><i class="fas fa-newspaper"></i></span> data journalism</li>
    <li class="fragment"><span class="fa-li"><i class="fas fa-paw"></i></span> wildlife manager in Canada</li>
</ul>
</li>
</ul>

# ![iNZight](assets/images/inzight_logo.png)

### Recently

<ul class="fa-ul">
<li><span class="fa-li"><i class="fas fa-users"></i></span> <strong>democratisation</strong>
<p>See Chris Wild's talks featuring hits like <i class="fas fa-music"></i> <em>We Will Plot You</em></p>
</li>
<li><span class="fa-li"><i class="fas fa-tachometer-alt"></i></span> <strong>rapid research development</strong> (Andrew Sporle)
<p>for organisations/groups with low/no money/time/both</p>
</li>
</ul>

# ![iNZight](assets/images/inzight_logo.png)

* recent focus on surveys --- now handled natively!

    * plots
    * summaries (tables of counts)
    * inference / modelling
    * data wrangling ...

* key goal is **removal of barriers**

# Surveys and iNZight

#

<div class="dual-panel">
<div class="left-panel">
Data

<div class="fragment" data-fragment-index="1">
<i class="fa fa-arrow-alt-circle-down"></i>

GUI
</div>

<div class="fragment" data-fragment-index="2">
<i class="fa fa-arrow-alt-circle-down"></i>

Explore
</div>

<div class="fragment" data-fragment-index="3">
<i class="fa fa-arrow-alt-circle-down"></i>

Export results/code
</div>
</div>

<div class="right-panel">

<img src="assets/images/gapminder08.png"
    class=""
    >

<img src="assets/images/inzight_gapminder.png"
    class="fragment current-visible"
    data-fragment-index="1">

<img src="assets/images/inzight_explore.png"
    class="fragment current-visible"
    data-fragment-index="2">

<img src="assets/images/inzight_code.png"
    class="fragment current-visible"
    data-fragment-index="3">

</div>
</div>

#

## What if `data` is from a survey?


#

In `r ricon`

```r
some_data <- read.csv('path/to/data')

some_svy <- survey::svydesign(~something,
    weights = ~FXWT3, # or another variable with 'WT' in it ...
    strata = ~does_it_have_any,
    fpc = ~i_dont_know_what_this_means
)

```

#

iNZight isn't much better ... <span class="fragment"><strong>or is it?!</strong></span>

![Specify survey design](assets/images/inzight_import_survey.png)

(Remember survey variables *never* have nice names)


#

## mysurvey.zip

<ul class="fa-ul loose">
<li><span class="fa-li"><i class="fas fa-file-csv"></i></span> mysurvey.csv</li>
<li><span class="fa-li"><i class="fas fa-file-alt"></i></span> mysurvey.svydesign</li>
</ul>


#

## Demo

<img src="assets/images/inzight_main_window.png"
    alt="iNZight main window"
    width="80%"
    >

#

## mysurvey.svydesign

```
data = "mysurvey.csv"
weights = "wt0"
repweights = "^w[0-4]"
reptype = "JK1"
```

<ul class="fa-ul loose">
<li><span class="fa-li"><i class="fas fa-wheelchair"></i></span> accessible</li>
<li><span class="fa-li"><i class="fas fa-tachometer-alt"></i></span> quickly open and explore</li>
<li><span class="fa-li"><i class="fas fa-desktop"></i></span> business as usual
<ul>
    <li>plots</li>
    <li>summaries/inference (population counts)</li>
    <li>data wrangling</li>
</ul>
</li>
</ul>


# (A few) Details
## iNZight's `r ricon` package collection

***
## 9+ **iNZight*** packages

* **iNZight** (GUI interface, collects user input, displays results)

* **iNZightModules** (UI for time series, regression, maps, ...)

* **iNZightPlots** (graphs, summaries, inference)

* **iNZightTools** (utility functions, data wrangling)

* **iNZightTS** (time series)

* **iNZightMR** (multiple response)

* **iNZightRegression** (model summaries, residual plots)

* **iNZightMaps** (lat/lng points, fill-in-the-shapefile maps)

* plus **vit** and some others ...

***

* **wrapper functions** makes programming GUIs easier

    * inputs $\equiv$ arguments

* packages don't need GUI

    * `iNZightPlots::inzplot()`

    * simple functions aimed towards novice coders

* returns the R code


<p class="fragment">GUI $\rightarrow$ high level functions $\rightarrow$ lower-level (e.g., <strong>ggplot</strong>)</p>



***
## An example: Filtering data


```{r}
library(iNZightTools)
iris_filtered <- filterNumeric(iris, "Sepal.Width", "<", 3.5)
head(iris_filtered)
code(iris_filtered)
```


***
## A slightly more complex example


```{r}
iris_agg <- aggregateData(iris, "Species", c("median", "var"), "Sepal.Length")
head(iris_agg)
code(iris_agg)
```



***

## What about surveys?

***

* modified wrapper functions to handle surveys

* refactored GUI to pass around a 'data-thing' (data or survey)

```{r,message=F,warning=F}
library(survey)
data(api, package = "survey")
dclus2 <- svydesign(id = ~dnum+snum,
    fpc = ~fpc1+fpc2,
    data = apiclus2
)
dclus2_filtered <- filterNumeric(dclus2, "api99", ">=", 700)
code(dclus2_filtered)
```

**Big thanks to the 'srvyr' package!**


# Te Rourou Tātaritanga

How does this all relate to my postdoc?

***

**Rourou** = basket

   *Nā tō rourou, nā taku rourou, ka ora ai te iwi.*

   (With your food basket and my food basket the people will thrive.)

**Tātaritanga** = analysis

<hr>

**Te Rourou Tātaritanga**

"Tools for analytics and sharing data for the betterment of communities."

<hr>

Or: "Informatics for Social Services and Wellbeing"


***

## Primary goals

1. Improve data standards

2. Promote Māori data sovereignty

3. Develop systems to support access

4. Evaluate synthesising of datasets

5. Security and privacy implications

6. Machine learning and AI methods

[terourou.org](https://terourou.org)

***

## Primary goals

1. **Improve data standards**

2. **Promote Māori data sovereignty**

3. **Develop systems to support access**

4. Evaluate synthesising of datasets

5. Security and privacy implications

6. Machine learning and AI methods

[terourou.org](https://terourou.org)


***
## The Integrated Data Infrastructure (IDI)

* database connecting data across NZs sectors

* high security environment

* but also other unnecessary barriers: **coding**!

***
## iNZight to the rescue!

* high school and/or university

* no coding necessary

* easy to learn **and relearn**

* iNZight in Stats NZ data lab ...? Watch this space!


***
## iNZight in the Data Lab (WIP)

Start confined to (example) small data sets ...

* primary researcher: SQL $\Rightarrow$ CSV

* non-coding researchers: graphs, tables, ...

... and build from there!

***
## iNZight outside the Data Lab


* iwi groups, pacific nations, etc. with specific needs

    * population summaries (tables of counts)

    * regression models

    * demographic models ...

* easy to learn **and relearn** 

    * repeat analyses after 6 months / 2 years

    * no (or low) (re)training or consultation costs

* produces R code script

***
## Bayesian demography

<p><em>Why limit yourself to tables when you can fit hierarchical Bayesian models with model-specific priors, likelihoods, … ?</em></p>

<ul class="fragment">
<li><p>John Bryant’s R packages (<strong>dembase</strong>, <strong>demest</strong>, …) for Bayesian demography</p></li>
<li><p>R coding required (and data transformations, working with multi-dimensional arrays, …)</p></li>
<li class="fragment"><p>so we tested out iNZight’s new add-on system …</p></li>
</ul>

***
## DEMO


# Other projects

Both work and 'fun'

***
## IDI Search App

<ul>
<li><p>to get access to the IDI, you need to put together a research proposal</p></li>
<li><p>putting together a research proposal requires knowing what data is available to investigate</p></li>
<li class="fragment"><p>that data is hidden away in the IDI</p></li>
</ul>

***

## IDI Search app

* simple web app (ReactJS)

* searchable database (schema, table name, variable name, descriptions where available)

* prospective (and current) IDI researchers can explore what's available

[terourou.org/idisearch](https://terourou.org/idisearch)


***
## DEMO

[idi-search.web.app](https://idi-search.web.app/)

***
## Bus display v2

* the display in 302 was broken

* rebuilt it (again) using ReactJS + d3

* uses newly available real-time occupancy 

***
## DEMO

[tomelliott.co.nz/bus-display](https://tomelliott.co.nz/bus-display/)

***
## Lots of ReactJS ...

* long-term goal: a prototype of iNZight built with ReactJS and R-serve

* a single app for Windows / macOS / Linux / web

* connecting to local/remote R server (user permissions, firewall, etc.)

***
## NO DEMO





# Thank you


Github: tmelliott | iNZightVIT | terourou

Twitter: @tomelliottnz | @iNZightUoA | @terourou

tomelliott.co.nz | inzight.nz | terourou.org

